<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset=utf-8>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>GIFify</title>
  <link rel="stylesheet" href="style.css">
  <link href="data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=" rel="icon" type="image/x-icon">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.5.0/knockout-min.js"></script>
</head>
<body>
  <h1>GIFify</h1>
  <form action="/api/requestfriend" method="POST">
    <input type="text" name="receiver" placeholder="username of friend">
    <input type="submit" name="submit" value="submit">
  </form>
  
  <button onclick="sendGifMessage()">send example message</button>
  
  <button onclick="getMessages()">reload messages</button>
  
  <div class="messageBox">
  	<div class="areMessages" style="display:none">
	  <img class="currentImage" src="./assets/imagefailed.svg">
	</div>
	<div class="noMessages" style="display:none">
	  
	</div>
  </div>
    
  <script>
  var currentShowing = 0
  
  function sendGifMessage() {
	$.ajax({ 
		url: "/api/sendgifmessage",
		data: {
			sender: "Tilier",
			receiver: "banana",
			gif: "idk",
			caption: "idkkkkkk"
		}, 
		type: "POST", // if you want to send data via the "data" property change this to "POST". This can be omitted otherwise 
		success: function(responseData) { 
			// empty mcmuffin
      	}, 
    	error: console.error 
    }); 
  }
  
  function getMessages() {
	$.ajax({ 
		url: "/api/messagelist",
		type: "GET", // if you want to send data via the "data" property change this to "POST". This can be omitted otherwise 
		success: function(responseData) { 
            // just testing what the JSON is going to look like.
			showMessages(responseData)
      	}, 
    	error: console.error 
    }); 
  }
  
  function showMessages(data) {
    if (data.length == 0) {
      document.querySelector(".noMessages").style.display = "block"
      document.querySelector(".areMessages").style.display = "none"
    } else {
      console.log(data)
      data = JSON.stringify(data)
      let currentData = data[currentShowing]
      console.log(currentData)
      document.querySelector(".areMessages").style.display = "block"
      document.querySelector(".noMessages").style.display = "none"
      document.querySelector(".currentImage").src = currentData["gif"]
    }
  }
  </script>
</body>
</html>